$(function(){function t(){switch(H(),direction==e?direction=u:u=direction,direction){case s:i[0]<=x?(i.unshift(I-o),f.unshift(f[0])):(i.unshift(i[0]-o),f.unshift(f[0]));break;case c:i[0]>=I-o?(i.unshift(x),f.unshift(f[0])):(i.unshift(i[0]+o),f.unshift(f[0]));break;case h:f[0]<=y?(f.unshift(_-o),i.unshift(i[0])):(f.unshift(f[0]-o),i.unshift(i[0]));break;case d:f[0]>=_-o?(f.unshift(y),i.unshift(i[0])):(f.unshift(f[0]+o),i.unshift(i[0]))}K();$(".part:gt(2)");w.last().fadeIn(),w.each(function(t){$(this).offset({top:f[t],left:i[t]})}),i.length=w.length+1,f.length=w.length+1,Q()&&(L(),R(),N(),F())}for(var e,n,o=50,r=200,a=1,i=[],f=[],s="left",c="right",h="up",d="down",u=direction=c,l=$("#parent"),g=l.width(),p=l.height(),b=0,k=l.offset().top,v=l.offset().left,m=v+4*o,M=k+4*o,w=$(".part"),x=v,I=v+g+2*b,y=k,_=p+k+2*b,C=0;C<w.length;C++)i[C]=m-=o,f[C]=M;for(var C=0;C<w.length;C++)$(w[C]).offset({top:f[C],left:i[C]});var G=$("#food"),O=(I-x)/o,P=Math.round(-0.5+Math.random()*O),j=Math.round(-0.5+Math.random()*O),q=x+o*P,z=y+o*j;G.offset({top:z,left:q});var A=($("#score"),$("#score_number")),B=$("#stage_number"),D=$("#speed_number"),E=0;A.text("score: 0"),B.text("stage: 1"),D.text("speed: 50");var F=function(){var t=$(".part:gt(2)"),e=Math.round(t.length*((250-r)/10)/10);E+=e,A.text("score: "+E),B.text("stage: "+a),D.text("speed: "+(250-r))};$("*").on("keyup",function(t){switch(t.keyCode){case 65:if(direction==c)break;direction=s,console.log(direction);break;case 68:if(direction==s)break;direction=c,console.log(direction);break;case 87:if(direction==d)break;direction=h,console.log(direction);break;case 83:if(direction==h)break;direction=d,console.log(direction);break;case 32:J();break;default:console.log(t.keyCode)}t.stopPropagation()});var H=function(){switch(u){case c:e=s;break;case s:e=c;break;case d:e=h;break;case h:e=d}return!1},J=function(){clearInterval(n),console.log("paused")},K=function(){for(var t=1;t<i.length;t++)i[0]==i[t]&&f[0]==f[t]&&(alert("Game Over!"),J())},L=function(){var e=$(".part:gt(1)");w.length%7||(u=direction=c,p-=o,g-=o,J(),w.hide(),G.hide(),e.remove(),++a,alert("stage "+a),$("#parent").animate({width:g,height:p},2e3,function(){r-=30,k=l.offset().top,v=l.offset().left,x=v,I=v+g+2*b,y=k,_=p+k+2*b,m=x+4*o,M=y+4*o;for(var e=0;e<w.length;e++)i[e]=m-=o,f[e]=M;for(var e=0;e<w.length;e++)$(w[e]).offset({top:f[e],left:i[e]});w.fadeIn(),G.show(),N(),n=setInterval(t,r)}))},N=function(){O=(I-x)/o,P=Math.round(-0.5+Math.random()*O),j=Math.round(-0.5+Math.random()*O),q=x+o*P,z=y+o*j,$.each(w,function(t){(q==i[t]||z==f[t])&&N()}),G.offset({top:z,left:q})},Q=function(){return G.offset().left==i[0]&&G.offset().top==f[0]?!0:!1},R=function(){$("#parent").append('<div class="part"></div>'),w=$(".part"),w.last().hide()};n=setInterval(t,r)});