function move(){oposite_direction_change(),direction==oposite_direction?direction=prev_direction:prev_direction=direction,colaps();$(".part:gt(2)");switch($parts.last().fadeIn(),$parts.each(function(e){$(this).offset({top:y[e],left:x[e]})}),direction){case left:x[0]<=portal_left?(x.unshift(portal_right-step),y.unshift(y[0])):(x.unshift(x[0]-step),y.unshift(y[0]));break;case right:x[0]>=portal_right-step?(x.unshift(portal_left),y.unshift(y[0])):(x.unshift(x[0]+step),y.unshift(y[0]));break;case up:y[0]<=portal_up?(y.unshift(portal_down-step),x.unshift(x[0])):(y.unshift(y[0]-step),x.unshift(x[0]));break;case down:y[0]>=portal_down-step?(y.unshift(portal_up),x.unshift(x[0])):(y.unshift(y[0]+step),x.unshift(x[0]))}x.length=$parts.length+1,y.length=$parts.length+1,isEating()&&(levelUp(),createTaile(),generateNewFood(),score_func())}for(var step=50,time=200,stageCount=1,x=[],y=[],left="left",right="right",up="up",down="down",prev_direction=direction=right,oposite_direction,pause=!1,snakeTime,$field=$("#parent"),field_width=$field.width(),field_height=$field.height(),border=0,field_top=$field.offset().top,field_left=$field.offset().left,x_head=field_left+4*step,y_head=field_top+4*step,$parts=$(".part"),portal_left=field_left,portal_right=field_left+field_width+2*border,portal_up=field_top,portal_down=field_height+field_top+2*border,i=0;i<$parts.length;i++)x[i]=x_head-=step,y[i]=y_head;for(var x_0=x,y_0=y,i=0;i<$parts.length;i++)$($parts[i]).offset({top:y[i],left:x[i]});var $food=$("#food"),steps_in_field=(portal_right-portal_left)/step,x_generate=Math.round(-0.5+Math.random()*steps_in_field),y_generate=Math.round(-0.5+Math.random()*steps_in_field),food_x=portal_left+step*x_generate,food_y=portal_up+step*y_generate;$food.offset({top:food_y,left:food_x});var $score=$("#score"),$score_number=$("#score_number"),$stage_number=$("#stage_number"),$speed_number=$("#speed_number"),total_all=0;$score_number.text("score: 0"),$stage_number.text("stage: 1"),$speed_number.text("speed: 50");var score_func=function(){var e=$(".part:gt(2)"),t=Math.round(e.length*((250-time)/10)/10);total_all+=t,$score_number.text("score: "+total_all),$stage_number.text("stage: "+stageCount),$speed_number.text("speed: "+(250-time))};$("*").on("keyup",function(e){switch(e.keyCode){case 37:if(direction==right)break;direction=left,console.log(direction);break;case 39:if(direction==left)break;direction=right,console.log(direction);break;case 38:if(direction==down)break;direction=up,console.log(direction);break;case 40:if(direction==up)break;direction=down,console.log(direction);break;case 32:theEnd();break;default:console.log(e.keyCode)}return!1});var oposite_direction_change=function(){switch(prev_direction){case right:oposite_direction=left;break;case left:oposite_direction=right;break;case down:oposite_direction=up;break;case up:oposite_direction=down}return!1},theEnd=function(){clearInterval(snakeTime),console.log("paused")},colaps=function(){for(var e=1;e<x.length;e++)x[0]==x[e]&&y[0]==y[e]&&(alert("Game Over!"),theEnd())},levelUp=function(){var e=$(".part:gt(1)");$parts.length%7||(prev_direction=direction=right,field_height-=step,field_width-=step,theEnd(),$parts.hide(),$food.hide(),e.remove(),++stageCount,alert("stage "+stageCount),$("#parent").animate({width:field_width,height:field_height},2e3,function(){time-=30,field_top=$field.offset().top,field_left=$field.offset().left,portal_left=field_left,portal_right=field_left+field_width+2*border,portal_up=field_top,portal_down=field_height+field_top+2*border,x_head=portal_left+4*step,y_head=portal_up+4*step;for(var e=0;e<$parts.length;e++)x[e]=x_head-=step,y[e]=y_head;for(var e=0;e<$parts.length;e++)$($parts[e]).offset({top:y[e],left:x[e]});$parts.fadeIn(),$food.show(),generateNewFood(),snakeTime=setInterval(move,time)}))},generateNewFood=function(){steps_in_field=(portal_right-portal_left)/step,x_generate=Math.round(-0.5+Math.random()*steps_in_field),y_generate=Math.round(-0.5+Math.random()*steps_in_field),food_x=portal_left+step*x_generate,food_y=portal_up+step*y_generate;for(var e=0;e<$parts.length;e++)(food_x==x[e]||food_y==y[e])&&generateNewFood();$food.offset({top:food_y,left:food_x})},isEating=function(){return $food.offset().left==x[0]&&$food.offset().top==y[0]?!0:!1},createTaile=function(){$("#parent").append('<div class="part"></div>'),$parts=$(".part"),$parts.last().hide()};snakeTime=setInterval(move,time);